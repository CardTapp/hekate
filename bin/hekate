#!/usr/bin/env ruby

require 'hekate/hekate'
require 'rubygems'
require 'commander/import'

# :name is optional, otherwise uses the basename of this executable
program :name, 'Hekate'
program :version, Hekate::VERSION
program :description, 'Gem for encrypting and storing rails application secrets as Amazon SSM parameters'

default_options = Proc.new do |c|
  c.option '--application STRING', String, 'The application name for which the imported secrets will be used'
  c.option '--environment STRING', String, 'The rails environment for which the imported secrets will be used. Defaults to development'
  c.option '--region STRING', String, 'The aws region to import into. Defaults to ENV["AWS_REGION"] || "us-west-2"'
end

command :import do |c|
  c.syntax = 'hekate import'
  c.description = 'imports a .env formatted file into Amazon SSM'
  default_options.call c
  c.option '--file STRING', String, 'The dotenv formatted file to import'
  c.action do |args, options|
    options.default \
      environment: :development,
      region: Hekate.get_region
  end
end

command :export do |c|
  c.syntax = 'hekate export'
  c.description = 'exports Amazon SSM parameters to a .env formatted file'
  default_options.call c
  c.option '--file STRING', String, 'The dotenv formatted file to export to'
  c.action do |args, options|
    options.default \
      environment: :development,
      region: Hekate.get_region
  end
end
